generator client {
  provider        = "prisma-client-js"
  previewFeatures = []
  binaryTargets   = ["native", "debian-openssl-3.0.x", "linux-musl-openssl-3.0.x", "rhel-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Analytics {
  id           String     @id @default(uuid())
  date         DateTime   @default(now())
  viewCount    Int        @default(1)
  restaurantId String
  productId    String?
  product      Product?   @relation(fields: [productId], references: [id], onDelete: Cascade)
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@unique([restaurantId, date])
  @@unique([restaurantId, productId, date])
  @@index([productId])
  @@index([restaurantId, date])
  @@map("analytics")
}

model Category {
  id           String     @id @default(uuid())
  name         String
  description  String?
  image        String?
  order        Int        @default(0)
  isActive     Boolean    @default(true)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  restaurantId String
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  products     Product[]

  @@index([order])
  @@index([restaurantId])
  @@map("categories")
}

model Image {
  id           String     @id @default(uuid())
  url          String
  filename     String
  mimetype     String
  size         Int
  type         ImageType  @default(OTHER)
  createdAt    DateTime   @default(now())
  restaurantId String
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@index([restaurantId])
  @@map("images")
}

model MenuView {
  id           String     @id @default(uuid())
  restaurantId String
  tableId      String?
  userAgent    String?
  deviceType   String?
  ip           String?
  referrer     String?
  currentPath  String?
  createdAt    DateTime   @default(now())
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([restaurantId, createdAt])
  @@map("menu_views")
}

model ProductView {
  id           String     @id @default(uuid())
  productId    String
  restaurantId String
  createdAt    DateTime   @default(now())
  product      Product    @relation(fields: [productId], references: [id], onDelete: Cascade)
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@index([productId, createdAt])
  @@index([restaurantId, createdAt])
  @@map("product_views")
}

model Product {
  id            String        @id @default(uuid())
  name          String
  description   String?
  price         Float
  image         String?
  imageUrl      String?
  isNew         Boolean       @default(false)
  isPopular     Boolean       @default(false)
  isDiscount    Boolean       @default(false)
  discountPrice Float?
  isAvailable   Boolean       @default(true)
  ingredients   String?
  allergens     String?
  isVegetarian  Boolean       @default(false)
  isVegan       Boolean       @default(false)
  isGlutenFree  Boolean       @default(false)
  isSpicy       Boolean       @default(false)
  order         Int           @default(0)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  categoryId    String
  analytics     Analytics[]
  productViews  ProductView[]
  category      Category      @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@index([categoryId])
  @@index([isAvailable])
  @@index([order])
  @@map("products")
}

model QRCode {
  id            String     @id @default(uuid())
  code          String     @unique
  tableNumber   String?
  imageUrl      String?
  imageData     String?    // Base64 encoded QR image
  scanCount     Int        @default(0)
  isActive      Boolean    @default(true)
  lastScannedAt DateTime?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  restaurantId  String
  restaurant    Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@index([code])
  @@index([restaurantId])
  @@map("qr_codes")
}

model RestaurantStatDaily {
  id                String     @id @default(uuid())
  restaurantId      String
  date              DateTime
  totalViews        Int        @default(0)
  totalProductViews Int        @default(0)
  uniqueVisitors    Int        @default(0)
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  restaurant        Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@unique([restaurantId, date])
  @@index([restaurantId, date])
  @@map("restaurant_stats_daily")
}

model Restaurant {
  id                  String                @id @default(uuid())
  memberNo            String?               @unique
  businessType        BusinessType          @default(RESTORAN)
  name                String
  slug                String                @unique
  description         String?
  address             String?
  city                String?
  district            String?
  neighborhood        String?
  fullAddress         String?
  phone               String?
  email               String?
  logo                String?
  headerImage         String?
  instagramUrl        String?
  facebookUrl         String?
  googleMapsUrl       String?
  workingHours        String?
  themeColor          String?               @default("#3B82F6")
  themeSettings       String?
  internalNote        String?
  isActive            Boolean               @default(true)
  membershipStatus    MembershipStatus      @default(ACTIVE)
  membershipStartDate DateTime?
  membershipEndDate   DateTime?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  ownerId             String
  analytics           Analytics[]
  categories          Category[]
  images              Image[]
  menuViews           MenuView[]
  productViews        ProductView[]
  qrCodes             QRCode[]
  restaurantStatDaily RestaurantStatDaily[]
  owner               User                  @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@index([ownerId])
  @@index([slug])
  @@index([memberNo])
  @@index([membershipEndDate])
  @@index([membershipStatus])
  @@map("restaurants")
}

model User {
  id          String       @id @default(uuid())
  email       String       @unique
  password    String
  name        String
  role        UserRole     @default(CUSTOMER)
  isActive    Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  restaurants Restaurant[]

  @@map("users")
}

model DemoRequest {
  id                  String                @id @default(cuid())
  fullName            String
  restaurantName      String
  phone               String
  email               String?
  restaurantType      String
  tableCount          Int
  status              DemoRequestStatus     @default(PENDING)
  potential           DemoRequestPotential?
  potentialStatus     PotentialStatus?      // Yeni kolon
  followUpMonth       String?               // Takip tarihi (YYYY-MM-DD format)
  notes               String?               // Satış süreci notları
  membershipStartDate String?
  membershipEndDate   String?
  createdAt           DateTime              @default(now())

  @@index([status])
  @@index([potential])
  @@index([potentialStatus])
  @@index([createdAt])
  @@map("demo_requests")
}

enum ImageType {
  LOGO
  PRODUCT
  CATEGORY
  OTHER
}

enum UserRole {
  SUPER_ADMIN
  RESTAURANT_ADMIN
  CUSTOMER
}

enum DemoRequestStatus {
  PENDING
  DEMO_CREATED
  FOLLOW_UP
  NEGATIVE
}

enum DemoRequestPotential {
  HIGH_PROBABILITY
  LONG_TERM
}

enum PotentialStatus {
  NONE
  PENDING
  DEMO_CREATED
  HIGH_PROBABILITY
  EVALUATING
  FOLLOW_UP
  LONG_TERM
  NEGATIVE
}

enum BusinessType {
  RESTORAN
  KAFE
  OTEL
  DIGER
}

enum MembershipStatus {
  ACTIVE
  EXPIRED
  SUSPENDED
}
